%!TEX root=../ast2016.tex

\begin{figure}
\centering

\scalebox{\algorithmfigurescalefactor}{
\begin{tabular}{|l|}
\hline

\begin{tabular}{l}
\vspace{-2ex} \\

{\bf function} obtain\_primary\_key\_constraint\_predicate($pkc(tbl, CL), nr$) \\

\atab {\bf where} \\
\atab \atab \tinybullet $pkc(tbl, CL), nr$ is a \PKC \\
\atab \atab \atab \tinybullet $tbl$ is the table on which the constraint is defined \\
\atab \atab \atab \tinybullet $CL = cl_1 ... cl_n$ is the set of columns of the constraint \\
\atab \atab \tinybullet $nr$ be a new row of data to be inserted into $tbl$ \smallvspace \smallvspace \\

\atab {\it // The test for null values:} \\
\atab {\bf let} $nc_{pk} \leftarrow (\selectneqnull{nr}{cl_1} \smallwedge \ldots \smallwedge \selectneqnull{nr}{cl_n})$ \smallvspace \\

\atab {\it // The test for uniqueness of values:} \\
\atab {\bf let} $cc_{pk} \leftarrow (\forallinrel{er}{tbl}: \selectneq{nr}{er}{cl_1} \smallvee \ldots \smallvee \selectneq{nr}{er}{cl_n})$ \smallvspace \\

\atab {\it // The complete integrity constraint predicate:} \\
\atab {\bf let} $icp_{pk} \leftarrow nc_{pk} \smallwedge cc_{pk}$ \smallvspace \\

\atab {\bf return} $icp_{pk}$ \smallvspace \\

{\bf end function} \\
\\

{\bf function} obtain\_primary\_key\_constraint\_predicate\_for\_\sqlite($pkc(tbl, CL), nr$) \\

\atab {\bf where} \\
\atab \atab \tinybullet $pkc(tbl, CL)$ is a \PKC for SQLite \\
\atab \atab \atab \tinybullet $tbl$ is the table on which the constraint is defined \\
\atab \atab \atab \tinybullet $CL = cl_1 ... cl_n$ is the set of columns of the constraint \\
\atab \atab \tinybullet $nr$ be a new row of data to be inserted into $tbl$ \smallvspace \smallvspace \\

\atab {\it // The test for null values:} \\
\atab {\bf let} $nc_{pk} \leftarrow (\selecteqnull{nr}{cl_1} \smallvee \ldots \smallvee \selecteqnull{nr}{cl_n})$ \smallvspace \\

\atab {\it // The test for uniqueness of values:} \\
\atab {\bf let} $cc_{pk} \leftarrow (\forallinrel{er}{tbl}: \selectneq{nr}{er}{cl_1} \smallvee \ldots \smallvee \selectneq{nr}{er}{cl_n})$ \smallvspace \\

\atab {\it // The complete integrity constraint predicate:} \\
\atab {\bf let} $icp_{pk} \leftarrow nc_{pk} \smallvee cc_{pk}$ \smallvspace \\

\atab {\bf return} $icp_{pk}$ \smallvspace \\

{\bf end function} \\

\vspace{-2ex} \\
\end{tabular} \\

\hline
\end{tabular}}

% NOTE: I have reduced the length of the main caption and then expanded the subcaption. This is now in line with what is
% in the captions for the graphs, a style which I adapted from the code that CJW originally wrote.

% \caption{\label{fig:integrity-constraint-functions} Functions for obtaining \PK integrity constraint predicates. }

\caption{\label{fig:integrity-constraint-functions} Integrity constraint predicate functions.}

  {\small \justifying{\noindent This figure gives two functions for obtaining \PK integrity constraint predicates. While
  the first function is a general definition, the second function applies to the specific behavior of the \sqlite
  database management system.  (Adapted from McMinn \etal~\cite{McMinn2015}.)} \par}

\vspace{-1.25em}
\end{figure}

